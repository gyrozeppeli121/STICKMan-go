<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Бегущий Стикман</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: sans-serif; background: #222; overflow: hidden; color: white; }
    canvas { background: #333; display: block; margin: 0 auto; margin-top: 20px; border: 2px solid #fff; }
    #ui {
      text-align: center;
      margin-top: 10px;
    }
    button {
      margin: 5px;
      padding: 10px 20px;
      font-size: 18px;
      cursor: pointer;
    }
    #shop {
      display: none;
      background: #111;
      padding: 10px;
      border: 2px solid white;
    }
    #shop h2 { margin-bottom: 10px; }
    .skin {
      background: #444;
      padding: 10px;
      margin: 5px;
      display: inline-block;
      cursor: pointer;
    }
  </style>
</head>
<body>

<canvas id="game" width="600" height="400"></canvas>

<div id="ui">
  <div>Очки: <span id="score">0</span> | Монеты: <span id="coins">0</span></div>
  <button onclick="togglePause()">Пауза</button>
  <button onclick="toggleShop()">Магазин</button>
</div>

<div id="shop">
  <h2>Магазин скинов</h2>
  <div class="skin" onclick="buySkin('red')">Красный (10 монет)</div>
  <div class="skin" onclick="buySkin('blue')">Синий (20 монет)</div>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let player = { x: 50, y: 300, size: 30, color: "white", vy: 0, jumpPower: -10, grounded: true };
let gravity = 0.5;
let obstacles = [];
let coins = [];
let bosses = [];
let score = 0;
let coinCount = 0;
let paused = false;
let skin = "white";

function spawnObstacle() {
  obstacles.push({ x: 600, y: 340, width: 20, height: 60 });
}

function spawnCoin() {
  coins.push({ x: 600, y: Math.random() * 200 + 100, radius: 10 });
}

function spawnBoss() {
  bosses.push({ x: 600, y: 250, width: 60, height: 100, speed: 3 });
}

function drawPlayer() {
  ctx.fillStyle = player.color;
  ctx.fillRect(player.x, player.y, player.size, player.size);
}

function drawObstacles() {
  ctx.fillStyle = "red";
  for (let o of obstacles) {
    ctx.fillRect(o.x, o.y, o.width, o.height);
  }
}

function drawCoins() {
  ctx.fillStyle = "yellow";
  for (let c of coins) {
    ctx.beginPath();
    ctx.arc(c.x, c.y, c.radius, 0, Math.PI * 2);
    ctx.fill();
  }
}

function drawBosses() {
  ctx.fillStyle = "purple";
  for (let b of bosses) {
    ctx.fillRect(b.x, b.y, b.width, b.height);
  }
}

function update() {
  if (paused) return;

  player.vy += gravity;
  player.y += player.vy;

  if (player.y + player.size > 370) {
    player.y = 370 - player.size;
    player.vy = 0;
    player.grounded = true;
  }

  // Obstacles
  for (let i = obstacles.length - 1; i >= 0; i--) {
    obstacles[i].x -= 5;
    if (
      player.x < obstacles[i].x + obstacles[i].width &&
      player.x + player.size > obstacles[i].x &&
      player.y < obstacles[i].y + obstacles[i].height &&
      player.y + player.size > obstacles[i].y
    ) {
      alert("Ты проиграл!");
      document.location.reload();
    }
    if (obstacles[i].x < -20) obstacles.splice(i, 1);
  }

  // Coins
  for (let i = coins.length - 1; i >= 0; i--) {
    coins[i].x -= 4;
    let dx = player.x + player.size / 2 - coins[i].x;
    let dy = player.y + player.size / 2 - coins[i].y;
    if (Math.sqrt(dx * dx + dy * dy) < coins[i].radius + player.size / 2) {
      coinCount++;
      coins.splice(i, 1);
      document.getElementById("coins").innerText = coinCount;
    }
    if (coins[i] && coins[i].x < -20) coins.splice(i, 1);
  }

  // Bosses
  for (let i = bosses.length - 1; i >= 0; i--) {
    bosses[i].x -= bosses[i].speed;
    if (
      player.x < bosses[i].x + bosses[i].width &&
      player.x + player.size > bosses[i].x &&
      player.y < bosses[i].y + bosses[i].height &&
      player.y + player.size > bosses[i].y
    ) {
      alert("Босс поймал тебя!");
      document.location.reload();
    }
    if (bosses[i].x < -100) bosses.splice(i, 1);
  }

  score++;
  document.getElementById("score").innerText = score;

    // Спавн боссов
  if (score % 25 === 0 && score !== 0 && bosses.length === 0) {
    spawnBoss();
  }

  // Спавн препятствий и монет
  if (score % 60 === 0) spawnObstacle();
  if (score % 80 === 0) spawnCoin();
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  drawPlayer();
  drawObstacles();
  drawCoins();
  drawBosses();
}

function gameLoop() {
  update();
  draw();
  requestAnimationFrame(gameLoop);
}

document.addEventListener("keydown", (e) => {
  if (e.code === "Space" && player.grounded && !paused) {
    player.vy = player.jumpPower;
    player.grounded = false;
  }
});

function togglePause() {
  paused = !paused;
}

function toggleShop() {
  const shop = document.getElementById("shop");
  shop.style.display = shop.style.display === "none" ? "block" : "none";
}

function buySkin(color) {
  const prices = { red: 10, blue: 20 };
  if (coinCount >= prices[color]) {
    coinCount -= prices[color];
    player.color = color;
    document.getElementById("coins").innerText = coinCount;
  } else {
    alert("Недостаточно монет!");
  }
}

gameLoop();
</script>

</body>
</html>
