<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Стикман GO</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    canvas { background: linear-gradient(to top, #444, #222); display: block; margin: auto; }
    #menu {
      position: absolute; top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: #111; padding: 20px; border-radius: 15px;
      color: white; text-align: center; display: none;
    }
    button {
      margin-top: 10px; padding: 10px 20px;
      background: #28a; color: white;
      border: none; border-radius: 8px;
      cursor: pointer;
    }
    #coinCount, #score { position: absolute; top: 10px; color: white; font-size: 20px; font-family: sans-serif; }
    #coinCount { left: 10px; }
    #score { right: 10px; }
  </style>
</head>
<body>
  <canvas id="game" width="800" height="400"></canvas>
  <div id="coinCount">Монеты: 0</div>
  <div id="score">Очки: 0</div>

  <div id="menu">
    <h2>Стикман GO</h2>
    <button onclick="startGame()">Начать</button>
    <button onclick="buySkin()">Купить скин (10 монет)</button>
  </div>

  <script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const coinDisplay = document.getElementById('coinCount');
    const scoreDisplay = document.getElementById('score');
    const menu = document.getElementById('menu');

    let player = { x: 100, y: 300, w: 40, h: 40, vy: 0, jumping: false, color: 'white' };
    let obstacles = [], coins = [], boss = null;
    let gravity = 1, score = 0, coinsCollected = 0;
    let gameRunning = false;

    function drawPlayer() {
      ctx.fillStyle = player.color;
      ctx.fillRect(player.x, player.y, player.w, player.h);
    }

    function createObstacle() {
      obstacles.push({ x: canvas.width, y: 360, w: 30, h: 40 });
    }

    function createCoin() {
      coins.push({ x: canvas.width, y: 250, r: 8 });
    }

    function createBoss() {
      boss = { x: canvas.width, y: 280, w: 80, h: 80, color: 'red' };
    }

    function drawBoss() {
      if (boss) {
        ctx.fillStyle = boss.color;
        ctx.fillRect(boss.x, boss.y, boss.w, boss.h);
      }
    }

    function drawObstacles() {
      ctx.fillStyle = 'brown';
      for (let obs of obstacles) {
        ctx.fillRect(obs.x, obs.y, obs.w, obs.h);
      }
    }

    function drawCoins() {
      ctx.fillStyle = 'yellow';
      for (let coin of coins) {
        ctx.beginPath();
        ctx.arc(coin.x, coin.y, coin.r, 0, Math.PI * 2);
        ctx.fill();
      }
    }

    function update() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Гравитация
      player.vy += gravity;
      player.y += player.vy;

      if (player.y >= 300) {
        player.y = 300;
        player.vy = 0;
        player.jumping = false;
      }

      // Обновление препятствий
      for (let obs of obstacles) obs.x -= 5;
      obstacles = obstacles.filter(o => o.x + o.w > 0);

      // Обновление монет
      for (let coin of coins) coin.x -= 5;
      coins = coins.filter(c => c.x + c.r > 0);

      // Проверка коллизий
      for (let obs of obstacles) {
        if (player.x < obs.x + obs.w &&
            player.x + player.w > obs.x &&
            player.y < obs.y + obs.h &&
            player.y + player.h > obs.y) {
          endGame();
        }
      }

      for (let i = coins.length - 1; i >= 0; i--) {
        let coin = coins[i];
        if (Math.abs(player.x - coin.x) < 20 && Math.abs(player.y - coin.y) < 30) {
          coins.splice(i, 1);
          coinsCollected++;
        }
      }

      if (boss) {
        boss.x -= 3;
        if (player.x < boss.x + boss.w &&
            player.x + player.w > boss.x &&
            player.y < boss.y + boss.h &&
            player.y + player.h > boss.y) {
          endGame();
        }
        if (boss.x + boss.w < 0) boss = null;
      }

      // Отображение
      drawPlayer();
      drawObstacles();
      drawCoins();
      drawBoss();

          // Обновление UI
      coinDisplay.textContent = 'Монеты: ' + coinsCollected;
      scoreDisplay.textContent = 'Очки: ' + score;

      if (gameRunning) requestAnimationFrame(update);
    }

    function jump() {
      if (!player.jumping) {
        player.vy = -15;
        player.jumping = true;
      }
    }

    function startGame() {
      player = { x: 100, y: 300, w: 40, h: 40, vy: 0, jumping: false, color: player.color };
      obstacles = [];
      coins = [];
      boss = null;
      score = 0;
      gameRunning = true;
      menu.style.display = 'none';
      update();

      // Генерация препятствий
      setInterval(() => {
        if (gameRunning) createObstacle();
      }, 1500);

      // Генерация монет
      setInterval(() => {
        if (gameRunning) createCoin();
      }, 2000);

      // Очки и боссы
      setInterval(() => {
        if (gameRunning) {
          score++;
          if (score % 25 === 0) createBoss();
        }
      }, 1000);
    }

    function endGame() {
      gameRunning = false;
      menu.style.display = 'block';
    }

    function buySkin() {
      if (coinsCollected >= 10) {
        coinsCollected -= 10;
        player.color = getRandomColor();
        alert("Новый скин активирован!");
      } else {
        alert("Недостаточно монет!");
      }
    }

    function getRandomColor() {
      const colors = ['cyan', 'lime', 'orange', 'magenta', 'blue', 'pink'];
      return colors[Math.floor(Math.random() * colors.length)];
    }

    // Контроль
    canvas.addEventListener('click', () => {
      if (gameRunning) jump();
    });

    menu.style.display = 'block';
  </script>
</body>
</html>
