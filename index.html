<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Бегущий Стикман</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: #111; overflow: hidden; font-family: sans-serif; }
    canvas { display: block; background: #222; margin: 0 auto; }
    #ui {
      position: absolute; top: 10px; left: 10px; color: white;
      font-size: 18px; z-index: 10;
    }
    #pauseBtn {
      position: absolute; top: 10px; right: 10px;
      padding: 10px 15px; background: #444; color: white;
      border: none; cursor: pointer;
    }
  </style>
</head>
<body>
  <canvas id="game" width="800" height="400"></canvas>
  <div id="ui">
    Очки: <span id="score">0</span><br>
    Монеты: <span id="coins">0</span>
  </div>
  <button id="pauseBtn">Пауза</button>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");

    let player = {
      x: 100, y: 300, w: 30, h: 50, vy: 0, jump: false, skin: "white"
    };

    let gravity = 0.8;
    let ground = 350;
    let obstacles = [];
    let coins = [];
    let bosses = [];
    let score = 0;
    let coinCount = 0;
    let paused = false;
    let frames = 0;

    document.getElementById("pauseBtn").onclick = () => paused = !paused;

    document.addEventListener("keydown", e => {
      if (e.code === "Space" && player.y >= ground) {
        player.vy = -15;
      }
    });

    function spawnObstacle() {
      obstacles.push({ x: 800, y: ground, w: 30, h: 50 });
    }

    function spawnCoin() {
      coins.push({ x: 800, y: ground - 50, r: 10 });
    }

    function spawnBoss() {
      bosses.push({ x: 800, y: ground - 100, w: 60, h: 100 });
    }

    function drawPlayer() {
      ctx.fillStyle = player.skin;
      ctx.fillRect(player.x, player.y, player.w, player.h);
    }

    function drawObstacles() {
      ctx.fillStyle = "red";
      obstacles.forEach(o => ctx.fillRect(o.x, o.y, o.w, o.h));
    }

    function drawCoins() {
      ctx.fillStyle = "gold";
      coins.forEach(c => {
        ctx.beginPath();
        ctx.arc(c.x, c.y, c.r, 0, Math.PI * 2);
        ctx.fill();
      });
    }

    function drawBosses() {
      ctx.fillStyle = "purple";
      bosses.forEach(b => ctx.fillRect(b.x, b.y, b.w, b.h));
    }

    function update() {
      if (paused) return;

      frames++;
      score += 0.05;

      player.vy += gravity;
      player.y += player.vy;
      if (player.y > ground) player.y = ground;

      if (frames % 120 === 0) spawnObstacle();
      if (frames % 180 === 0) spawnCoin();
      if (Math.floor(score) % 25 === 0 && !bosses.some(b => b.x > 400)) spawnBoss();

      obstacles.forEach(o => o.x -= 4);
      coins.forEach(c => c.x -= 4);
      bosses.forEach(b => b.x -= 2);

      obstacles = obstacles.filter(o => o.x + o.w > 0);
      coins = coins.filter(c => c.x + c.r > 0);
      bosses = bosses.filter(b => b.x + b.w > 0);

      // Столкновения с препятствиями
      obstacles.forEach(o => {
        if (
          player.x < o.x + o.w &&
          player.x + player.w > o.x &&
          player.y < o.y + o.h &&
          player.y + player.h > o.y
        ) {
          resetGame();
        }
      });

      // Подбор монет
      coins.forEach((c, i) => {
        const dx = player.x + player.w / 2 - c.x;
        const dy = player.y + player.h / 2 - c.y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        if (dist < c.r + player.w / 2) {
          coinCount++;
          coins.splice(i, 1);
        }
      });

      // Столкновение с боссом
      bosses.forEach(b => {
        if (
          player.x < b.x + b.w &&
          player.x + player.w > b.x &&
          player.y < b.y + b.h &&
          player.y + player.h > b.y
        ) {
          resetGame();
        }
      });

      document.getElementById("score").innerText = Math.floor(score);
      document.getElementById("coins").innerText = coinCount;
    }

        function resetGame() {
      player.y = ground;
      player.vy = 0;
      score = 0;
      coinCount = 0;
      obstacles = [];
      coins = [];
      bosses = [];
      frames = 0;
    }

    function gameLoop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      update();
      drawPlayer();
      drawObstacles();
      drawCoins();
      drawBosses();

      requestAnimationFrame(gameLoop);
    }

    gameLoop();
  </script>
</body>
</html>
